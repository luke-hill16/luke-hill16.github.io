import{r as b,X as h,c as Ve,k as xe,z as $,A as g,P as e,H as t,I as Ce,G as ke,ag as r,aq as Me,y as B,u as O,L as s,a5 as Se,M as _,K as P,n as De}from"./chunk-CnY5n9_A.js";import{L as Be,H as Q,A as Y,z as N}from"./chunk-BtzBX2c4.js";import{_ as Te}from"./chunk-DlAUqK2U.js";const ze={class:"building-container"},Ue={class:"page-header"},he={class:"search-section"},$e={class:"building-list"},Le={class:"pagination-container"},Re={class:"dialog-footer"},qe={key:0,class:"building-detail"},Fe={class:"dialog-footer"},Ie={key:0,style:{"margin-top":"16px"}},Oe={key:1,style:{"margin-top":"24px"}},Pe={__name:"building",setup(Ne){const ee=b(!1),L=b(!1),k=b(!1),T=b(!1),S=b(),d=b(null),R=b(!1),i=h({start:"",end:""}),D=b(""),q=b([]),w=h({name:"",status:"",type:""}),v=h({currentPage:1,pageSize:10,total:0}),n=h({id:null,name:"",type:"",address:"",floors:1,area:0,status:"normal",buildDate:"",description:""}),le={name:[{required:!0,message:"请输入建筑名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择建筑类型",trigger:"change"}],address:[{required:!0,message:"请输入建筑地址",trigger:"blur"}],floors:[{required:!0,message:"请输入楼层数",trigger:"blur"}],area:[{required:!0,message:"请输入建筑面积",trigger:"blur"}],status:[{required:!0,message:"请选择建筑状态",trigger:"change"}],buildDate:[{required:!0,message:"请选择建成日期",trigger:"change"}]},C=b([{id:1,name:"益客大厦A座",type:"office",address:"北京市朝阳区建国路88号",floors:25,area:15000.5,status:"normal",buildDate:"2020-06-15",description:"现代化办公大楼，配套设施完善",createTime:"2020-01-01 10:00:00"},{id:2,name:"益客住宅小区",type:"residential",address:"北京市海淀区中关村大街100号",floors:18,area:25e3,status:"normal",buildDate:"2019-12-01",description:"高品质住宅小区，环境优美",createTime:"2019-06-01 10:00:00"},{id:3,name:"益客商业中心",type:"commercial",address:"北京市西城区西单大街200号",floors:12,area:18e3,status:"maintenance",buildDate:"2018-08-20",description:"综合性商业中心，交通便利",createTime:"2018-03-01 10:00:00"}]),te=Ve(()=>n.id?"编辑建筑":"添加建筑"),A=o=>({office:"办公楼",residential:"住宅楼",commercial:"商业楼",industrial:"工业建筑"})[o]||"未知",H=o=>({office:"primary",residential:"success",commercial:"warning",industrial:"info"})[o]||"",j=o=>({normal:"正常",maintenance:"维护中",disabled:"停用"})[o]||"未知",E=o=>({normal:"success",maintenance:"warning",disabled:"danger"})[o]||"",ae=()=>{n.id=null,k.value=!0},oe=o=>{Object.assign(n,o),k.value=!0},ne=o=>{d.value=o,T.value=!0},se=async o=>{try{await Y.confirm(`确定要删除建筑"${o.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=C.value.findIndex(p=>p.id===o.id);l>-1&&(C.value.splice(l,1),N.success("删除成功"))}catch{}},ie=async()=>{if(S.value)try{if(await S.value.validate(),L.value=!0,await new Promise(o=>setTimeout(o,1e3)),n.id){const o=C.value.findIndex(l=>l.id===n.id);o>-1&&(C.value[o]={...n}),N.success("编辑成功")}else{const o={...n,id:Date.now(),createTime:new Date().toLocaleString()};C.value.unshift(o),N.success("添加成功")}k.value=!1,Z()}catch(o){console.error("表单验证失败:",o)}finally{L.value=!1}},Z=()=>{S.value&&S.value.resetFields(),Object.assign(n,{id:null,name:"",type:"",address:"",floors:1,area:0,status:"normal",buildDate:"",description:""})},M=()=>{v.currentPage=1,console.log("搜索条件:",w)},re=()=>{Object.assign(w,{name:"",status:"",type:""}),M()},de=o=>{v.pageSize=o},ue=o=>{v.currentPage=o};function pe(){var o;i.start="",i.end=((o=d.value)==null?void 0:o.address)||"",D.value="",R.value=!0,De(()=>{fe()}),K()}function J(){if(!i.start||!i.end){D.value="请填写起点和终点";return}const o=new window.BMap.Map("baiduMapContainer");o.centerAndZoom(i.end,14),o.enableScrollWheelZoom(!0),new window.BMap.DrivingRoute(o,{renderOptions:{map:o,autoViewport:!0}}).search(i.start,i.end),D.value=`已为您规划从【${i.start}】到【${i.end}】的路径`,ce({start:i.start,end:i.end,time:new Date().toLocaleString()}),K()}function me(o){i.start=o.start,i.end=o.end,J()}function fe(){const o=new window.BMap.Map("baiduMapContainer");o.centerAndZoom(i.end||"北京",12),o.enableScrollWheelZoom(!0),o.clearOverlays(),o.addEventListener("click",function(l){const p=l.point;new window.BMap.Geocoder().getLocation(p,function(V){const x=V.address;Y({title:"地图点选",message:`将【${x}】设为起点还是终点？`,showCancelButton:!0,confirmButtonText:"起点",cancelButtonText:"终点"}).then(()=>{i.start=x}).catch(()=>{i.end=x})})})}function ce(o){const l="building_route_history";let p=JSON.parse(localStorage.getItem(l)||"[]");p.unshift(o),p.length>10&&(p=p.slice(0,10)),localStorage.setItem(l,JSON.stringify(p))}function K(){const o="building_route_history";q.value=JSON.parse(localStorage.getItem(o)||"[]")}return xe(()=>{v.total=C.value.length}),(o,l)=>{const p=r("el-icon"),m=r("el-button"),V=r("el-input"),x=r("el-col"),u=r("el-option"),z=r("el-select"),ge=r("el-row"),f=r("el-table-column"),U=r("el-tag"),G=r("el-table"),_e=r("el-pagination"),c=r("el-form-item"),W=r("el-input-number"),be=r("el-date-picker"),X=r("el-form"),F=r("el-dialog"),y=r("el-descriptions-item"),ve=r("el-descriptions"),ye=r("el-alert"),we=Me("loading");return B(),$("div",ze,[g("div",Ue,[l[21]||(l[21]=g("h2",null,"建筑管理系统",-1)),e(m,{type:"primary",onClick:ae},{default:t(()=>[e(p,null,{default:t(()=>[e(O(Be))]),_:1}),l[20]||(l[20]=s(" 添加建筑 "))]),_:1,__:[20]})]),g("div",he,[e(ge,{gutter:20},{default:t(()=>[e(x,{span:6},{default:t(()=>[e(V,{modelValue:w.name,"onUpdate:modelValue":l[0]||(l[0]=a=>w.name=a),placeholder:"建筑名称",clearable:"",onClear:M,onKeyup:Se(M,["enter"])},{prefix:t(()=>[e(p,null,{default:t(()=>[e(O(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(x,{span:6},{default:t(()=>[e(z,{modelValue:w.status,"onUpdate:modelValue":l[1]||(l[1]=a=>w.status=a),placeholder:"建筑状态",clearable:"",onChange:M},{default:t(()=>[e(u,{label:"正常",value:"normal"}),e(u,{label:"维护中",value:"maintenance"}),e(u,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(x,{span:6},{default:t(()=>[e(z,{modelValue:w.type,"onUpdate:modelValue":l[2]||(l[2]=a=>w.type=a),placeholder:"建筑类型",clearable:"",onChange:M},{default:t(()=>[e(u,{label:"办公楼",value:"office"}),e(u,{label:"住宅楼",value:"residential"}),e(u,{label:"商业楼",value:"commercial"}),e(u,{label:"工业建筑",value:"industrial"})]),_:1},8,["modelValue"])]),_:1}),e(x,{span:6},{default:t(()=>[e(m,{type:"primary",onClick:M},{default:t(()=>[e(p,null,{default:t(()=>[e(O(Q))]),_:1}),l[22]||(l[22]=s(" 搜索 "))]),_:1,__:[22]}),e(m,{onClick:re},{default:t(()=>l[23]||(l[23]=[s("重置")])),_:1,__:[23]})]),_:1})]),_:1})]),g("div",$e,[Ce((B(),ke(G,{data:C.value,stripe:""},{default:t(()=>[e(f,{prop:"id",label:"ID",width:"80"}),e(f,{prop:"name",label:"建筑名称"}),e(f,{prop:"type",label:"建筑类型"},{default:t(a=>[e(U,{type:H(a.row.type)},{default:t(()=>[s(_(A(a.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"address",label:"地址"}),e(f,{prop:"floors",label:"楼层数",width:"100"}),e(f,{prop:"area",label:"建筑面积(m²)",width:"120"}),e(f,{prop:"status",label:"状态",width:"100"},{default:t(a=>[e(U,{type:E(a.row.status)},{default:t(()=>[s(_(j(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"buildDate",label:"建成日期",width:"120"}),e(f,{label:"操作",width:"200",fixed:"right"},{default:t(a=>[e(m,{size:"small",onClick:I=>ne(a.row)},{default:t(()=>l[24]||(l[24]=[s("查看")])),_:2,__:[24]},1032,["onClick"]),e(m,{size:"small",type:"primary",onClick:I=>oe(a.row)},{default:t(()=>l[25]||(l[25]=[s("编辑")])),_:2,__:[25]},1032,["onClick"]),e(m,{size:"small",type:"danger",onClick:I=>se(a.row)},{default:t(()=>l[26]||(l[26]=[s("删除")])),_:2,__:[26]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[we,ee.value]]),g("div",Le,[e(_e,{"current-page":v.currentPage,"onUpdate:currentPage":l[3]||(l[3]=a=>v.currentPage=a),"page-size":v.pageSize,"onUpdate:pageSize":l[4]||(l[4]=a=>v.pageSize=a),"page-sizes":[10,20,50,100],total:v.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ue},null,8,["current-page","page-size","total"])])]),e(F,{modelValue:k.value,"onUpdate:modelValue":l[14]||(l[14]=a=>k.value=a),title:te.value,width:"600px",onClose:Z},{footer:t(()=>[g("div",Re,[e(m,{onClick:l[13]||(l[13]=a=>k.value=!1)},{default:t(()=>l[28]||(l[28]=[s("取消")])),_:1,__:[28]}),e(m,{type:"primary",onClick:ie,loading:L.value},{default:t(()=>l[29]||(l[29]=[s("确定")])),_:1,__:[29]},8,["loading"])])]),default:t(()=>[e(X,{model:n,rules:le,ref_key:"buildingFormRef",ref:S,"label-width":"100px"},{default:t(()=>[e(c,{label:"建筑名称",prop:"name"},{default:t(()=>[e(V,{modelValue:n.name,"onUpdate:modelValue":l[5]||(l[5]=a=>n.name=a),placeholder:"请输入建筑名称"},null,8,["modelValue"])]),_:1}),e(c,{label:"建筑类型",prop:"type"},{default:t(()=>[e(z,{modelValue:n.type,"onUpdate:modelValue":l[6]||(l[6]=a=>n.type=a),placeholder:"请选择建筑类型",style:{width:"100%"}},{default:t(()=>[e(u,{label:"办公楼",value:"office"}),e(u,{label:"住宅楼",value:"residential"}),e(u,{label:"商业楼",value:"commercial"}),e(u,{label:"工业建筑",value:"industrial"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"地址",prop:"address"},{default:t(()=>[e(V,{modelValue:n.address,"onUpdate:modelValue":l[7]||(l[7]=a=>n.address=a),placeholder:"请输入建筑地址"},null,8,["modelValue"])]),_:1}),e(c,{label:"楼层数",prop:"floors"},{default:t(()=>[e(W,{modelValue:n.floors,"onUpdate:modelValue":l[8]||(l[8]=a=>n.floors=a),min:1,max:200,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"建筑面积",prop:"area"},{default:t(()=>[e(W,{modelValue:n.area,"onUpdate:modelValue":l[9]||(l[9]=a=>n.area=a),min:1,precision:2,style:{width:"100%"}},null,8,["modelValue"]),l[27]||(l[27]=g("span",{style:{"margin-left":"10px",color:"#666"}},"m²",-1))]),_:1,__:[27]}),e(c,{label:"建筑状态",prop:"status"},{default:t(()=>[e(z,{modelValue:n.status,"onUpdate:modelValue":l[10]||(l[10]=a=>n.status=a),placeholder:"请选择建筑状态",style:{width:"100%"}},{default:t(()=>[e(u,{label:"正常",value:"normal"}),e(u,{label:"维护中",value:"maintenance"}),e(u,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"建成日期",prop:"buildDate"},{default:t(()=>[e(be,{modelValue:n.buildDate,"onUpdate:modelValue":l[11]||(l[11]=a=>n.buildDate=a),type:"date",placeholder:"选择建成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"描述",prop:"description"},{default:t(()=>[e(V,{modelValue:n.description,"onUpdate:modelValue":l[12]||(l[12]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入建筑描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(F,{modelValue:T.value,"onUpdate:modelValue":l[16]||(l[16]=a=>T.value=a),title:"建筑详情",width:"800px"},{footer:t(()=>[g("div",Fe,[e(m,{onClick:l[15]||(l[15]=a=>T.value=!1)},{default:t(()=>l[30]||(l[30]=[s("关闭")])),_:1,__:[30]}),e(m,{type:"primary",onClick:pe},{default:t(()=>l[31]||(l[31]=[s("路径规划")])),_:1,__:[31]})])]),default:t(()=>[d.value?(B(),$("div",qe,[e(ve,{column:2,border:""},{default:t(()=>[e(y,{label:"建筑名称"},{default:t(()=>[s(_(d.value.name),1)]),_:1}),e(y,{label:"建筑类型"},{default:t(()=>[e(U,{type:H(d.value.type)},{default:t(()=>[s(_(A(d.value.type)),1)]),_:1},8,["type"])]),_:1}),e(y,{label:"地址"},{default:t(()=>[s(_(d.value.address),1)]),_:1}),e(y,{label:"楼层数"},{default:t(()=>[s(_(d.value.floors)+"层",1)]),_:1}),e(y,{label:"建筑面积"},{default:t(()=>[s(_(d.value.area)+" m²",1)]),_:1}),e(y,{label:"建筑状态"},{default:t(()=>[e(U,{type:E(d.value.status)},{default:t(()=>[s(_(j(d.value.status)),1)]),_:1},8,["type"])]),_:1}),e(y,{label:"建成日期"},{default:t(()=>[s(_(d.value.buildDate),1)]),_:1}),e(y,{label:"创建时间"},{default:t(()=>[s(_(d.value.createTime),1)]),_:1}),e(y,{label:"描述",span:2},{default:t(()=>[s(_(d.value.description||"暂无描述"),1)]),_:1})]),_:1})])):P("",!0)]),_:1},8,["modelValue"]),e(F,{modelValue:R.value,"onUpdate:modelValue":l[19]||(l[19]=a=>R.value=a),title:"路径规划",width:"800px"},{default:t(()=>[g("div",null,[e(X,{model:i,"label-width":"80px",inline:""},{default:t(()=>[e(c,{label:"起点"},{default:t(()=>[e(V,{modelValue:i.start,"onUpdate:modelValue":l[17]||(l[17]=a=>i.start=a),placeholder:"请输入起点",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(c,{label:"终点"},{default:t(()=>[e(V,{modelValue:i.end,"onUpdate:modelValue":l[18]||(l[18]=a=>i.end=a),placeholder:"请输入终点",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(c,null,{default:t(()=>[e(m,{type:"primary",onClick:J},{default:t(()=>l[32]||(l[32]=[s("规划路径")])),_:1,__:[32]})]),_:1})]),_:1},8,["model"]),l[35]||(l[35]=g("div",{id:"baiduMapContainer",style:{width:"100%",height:"400px","margin-top":"16px"}},null,-1)),D.value?(B(),$("div",Ie,[e(ye,{title:D.value,type:"success","show-icon":""},null,8,["title"])])):P("",!0),q.value.length?(B(),$("div",Oe,[l[34]||(l[34]=g("h4",null,"历史路径规划",-1)),e(G,{data:q.value,size:"small",style:{width:"100%"}},{default:t(()=>[e(f,{prop:"start",label:"起点"}),e(f,{prop:"end",label:"终点"}),e(f,{prop:"time",label:"时间",width:"180"}),e(f,{label:"操作",width:"80"},{default:t(a=>[e(m,{size:"small",onClick:I=>me(a.row)},{default:t(()=>l[33]||(l[33]=[s("回显")])),_:2,__:[33]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):P("",!0)])]),_:1},8,["modelValue"])])}}},Ee=Te(Pe,[["__scopeId","data-v-aa77908f"]]);export{Ee as default};
