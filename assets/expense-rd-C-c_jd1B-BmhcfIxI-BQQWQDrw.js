import{T as Ce,B as y,S as L,o as je,a as o,b as r,O as D,$ as l,K as a,_ as s,H as d,i as Ue,f as Te,W as Ne,k as v,s as i,d as $,c as $e,p as qe,J as g,e as E}from"./index-2YECzvFn.js";const ze={class:"rd-expense-container"},Ye={class:"header"},Be={class:"header-actions"},Re={class:"search-section"},Le=["onClick"],De={class:"amount"},Se={key:0,class:"expense-detail"},Fe={class:"card-header"},Me={class:"detail-item"},Pe={class:"detail-item"},Ie={class:"detail-item"},Je={class:"amount"},Ke={class:"detail-item"},Ae={class:"detail-item"},He={class:"detail-item"},We={class:"detail-item"},Ge={class:"content-text"},Ee={class:"timeline-content"},Oe={class:"timeline-title"},Qe={class:"timeline-user"},Xe={key:0,class:"timeline-comment"},Ze={class:"dialog-footer"},ea={class:"dialog-footer"},aa={class:"statistics-content"},la={class:"stat-number"},ta={class:"stat-number"},ua={class:"stat-number"},sa={class:"stat-number"},da={__name:"expense-rd",setup(ra){const w=y([]),q=y(!1),n=y(null),V=y(!1),z=y("申请费用"),S=y(null),T=y(!1),F=y(null),Y=y(!1),M=y([]),c=y({keyword:"",status:"",type:"",dateRange:[]}),P=[{id:"exp001",projectName:"AI算法优化项目",type:"equipment",amount:5e4,status:"pending",applicant:"张工程师",department:"技术部",applyTime:"2024-01-15 09:00:00",approver:"",description:"购买高性能GPU服务器用于AI模型训练，提升算法性能。"},{id:"exp002",projectName:"移动端开发项目",type:"software",amount:15e3,status:"approved",applicant:"李开发",department:"技术部",applyTime:"2024-01-14 14:30:00",approver:"王经理",description:"购买移动端开发工具和第三方SDK授权。"},{id:"exp003",projectName:"产品设计项目",type:"personnel",amount:8e3,status:"paid",applicant:"陈设计师",department:"设计部",applyTime:"2024-01-13 11:20:00",approver:"刘总监",description:"外聘专业设计师进行产品界面设计。"},{id:"exp004",projectName:"技术交流会议",type:"travel",amount:3e3,status:"rejected",applicant:"赵研究员",department:"研发部",applyTime:"2024-01-12 16:45:00",approver:"孙经理",description:"参加行业技术交流会议，包括差旅费和会议费。"}],I=y([{action:"提交申请",user:"张工程师",department:"技术部",time:"2024-01-15 09:00:00",type:"submit"}]),b=y({projectName:"",type:"",amount:0,description:""}),x=y({result:"approve",comment:""}),O={projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],type:[{required:!0,message:"请选择费用类型",trigger:"change"}],amount:[{required:!0,message:"请输入申请金额",trigger:"blur"}],description:[{required:!0,message:"请输入费用说明",trigger:"blur"}]},Q={result:[{required:!0,message:"请选择审批结果",trigger:"change"}],comment:[{required:!0,message:"请输入审批意见",trigger:"blur"}]},X=L(()=>w.value.reduce((u,e)=>u+e.amount,0)),Z=L(()=>w.value.filter(u=>u.status==="pending").length),ee=L(()=>w.value.filter(u=>u.status==="approved").length),ae=L(()=>w.value.filter(u=>u.status==="paid").length),B=async()=>{try{await new Promise(u=>setTimeout(u,500)),w.value=P,g.success("费用列表加载成功")}catch{g.error("获取费用列表失败")}},le=()=>{B()},te=()=>{z.value="申请费用",b.value={projectName:"",type:"",amount:0,description:""},M.value=[],V.value=!0},ue=u=>{z.value="编辑费用",b.value={...u},V.value=!0},se=async()=>{try{await S.value.validate(),await new Promise(u=>setTimeout(u,1e3)),g.success(z.value==="申请费用"?"费用申请提交成功":"费用信息更新成功"),V.value=!1,B()}catch{g.error("表单验证失败")}},de=async u=>{try{await E.confirm(`确定要删除费用申请"${u.projectName}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),w.value=w.value.filter(e=>e.id!==u.id),g.success("删除成功")}catch{g.info("已取消删除")}},A=u=>{n.value=u,q.value=!0,ce(u.id)},re=u=>{n.value=u,x.value={result:"approve",comment:""},T.value=!0},pe=async()=>{try{await F.value.validate(),await new Promise(e=>setTimeout(e,1e3));const u=w.value.find(e=>e.id===n.value.id);u&&(u.status=x.value.result==="approve"?"approved":"rejected",u.approver="当前用户"),g.success("审批完成"),T.value=!1,B()}catch{g.error("表单验证失败")}},oe=async u=>{try{await E.confirm(`确定要支付费用"${u.projectName}"吗？`,"确认支付",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.status="paid",g.success("支付成功")}catch{g.info("已取消支付")}},ie=()=>{Y.value=!0},H=()=>{console.log("搜索条件:",c.value);let u=[...P];if(c.value.keyword){const e=c.value.keyword.toLowerCase();u=u.filter(p=>p.projectName.toLowerCase().includes(e)||p.applicant.toLowerCase().includes(e)||p.department.toLowerCase().includes(e))}if(c.value.status&&(u=u.filter(e=>e.status===c.value.status)),c.value.type&&(u=u.filter(e=>e.type===c.value.type)),c.value.dateRange&&c.value.dateRange.length===2){const[e,p]=c.value.dateRange;u=u.filter(J=>{const C=J.applyTime.split(" ")[0];return C>=e&&C<=p})}w.value=u,u.length===0?g.info("没有找到匹配的费用记录"):g.success(`找到 ${u.length} 条费用记录`)},ne=()=>{c.value={keyword:"",status:"",type:"",dateRange:[]},w.value=[...P],g.success("搜索条件已重置")},ce=u=>{I.value=[{action:"提交申请",user:"张工程师",department:"技术部",time:"2024-01-15 09:00:00",type:"submit"}]},me=(u,e)=>{console.log("文件变化:",u,e)},_e=()=>{q.value=!1,n.value=null,I.value=[]},ve=()=>{var u;V.value=!1,(u=S.value)==null||u.resetFields(),M.value=[]},fe=()=>{var u;T.value=!1,(u=F.value)==null||u.resetFields()},ye=()=>{Y.value=!1};return je(B),(u,e)=>{const p=o("el-button"),J=o("el-icon"),C=o("el-input"),m=o("el-col"),f=o("el-option"),K=o("el-select"),ge=o("el-date-picker"),j=o("el-row"),h=o("el-table-column"),_=o("el-tag"),we=o("el-table"),k=o("el-card"),be=o("el-timeline-item"),he=o("el-timeline"),R=o("el-dialog"),U=o("el-form-item"),ke=o("el-input-number"),Ve=o("el-upload"),W=o("el-form"),G=o("el-radio"),xe=o("el-radio-group");return r(),D("div",ze,[l(k,null,{default:a(()=>[s("div",Ye,[e[20]||(e[20]=s("span",null,"研发费用管理",-1)),s("div",Be,[l(p,{type:"primary",onClick:te,size:"small"},{default:a(()=>e[17]||(e[17]=[d("申请费用")])),_:1,__:[17]}),l(p,{type:"success",onClick:le,size:"small"},{default:a(()=>e[18]||(e[18]=[d("刷新")])),_:1,__:[18]}),l(p,{type:"info",onClick:ie,size:"small"},{default:a(()=>e[19]||(e[19]=[d("费用统计")])),_:1,__:[19]})])]),s("div",Re,[l(j,{gutter:20},{default:a(()=>[l(m,{span:6},{default:a(()=>[l(C,{modelValue:c.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value.keyword=t),placeholder:"搜索项目名称或申请人",clearable:"",onKeyup:Ue(H,["enter"])},{prefix:a(()=>[l(J,null,{default:a(()=>[l(Te(Ne))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{span:4},{default:a(()=>[l(K,{modelValue:c.value.status,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value.status=t),placeholder:"状态",clearable:""},{default:a(()=>[l(f,{label:"待审批",value:"pending"}),l(f,{label:"已通过",value:"approved"}),l(f,{label:"已拒绝",value:"rejected"}),l(f,{label:"已支付",value:"paid"})]),_:1},8,["modelValue"])]),_:1}),l(m,{span:4},{default:a(()=>[l(K,{modelValue:c.value.type,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.type=t),placeholder:"费用类型",clearable:""},{default:a(()=>[l(f,{label:"设备采购",value:"equipment"}),l(f,{label:"软件许可",value:"software"}),l(f,{label:"人员费用",value:"personnel"}),l(f,{label:"差旅费用",value:"travel"}),l(f,{label:"其他费用",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(m,{span:6},{default:a(()=>[l(ge,{modelValue:c.value.dateRange,"onUpdate:modelValue":e[3]||(e[3]=t=>c.value.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(m,{span:4},{default:a(()=>[l(p,{type:"primary",onClick:H},{default:a(()=>e[21]||(e[21]=[d("搜索")])),_:1,__:[21]}),l(p,{onClick:ne},{default:a(()=>e[22]||(e[22]=[d("重置")])),_:1,__:[22]})]),_:1})]),_:1})]),l(we,{data:w.value,style:{width:"100%","margin-top":"20px"},fit:"true"},{default:a(()=>[l(h,{prop:"projectName",label:"项目名称","min-width":"150"},{default:a(t=>[s("span",{class:"clickable-title",onClick:N=>A(t.row)},v(t.row.projectName),9,Le)]),_:1}),l(h,{prop:"type",label:"费用类型","min-width":"120"},{default:a(t=>[t.row.type==="equipment"?(r(),i(_,{key:0,type:"primary"},{default:a(()=>e[23]||(e[23]=[d("设备采购")])),_:1,__:[23]})):t.row.type==="software"?(r(),i(_,{key:1,type:"success"},{default:a(()=>e[24]||(e[24]=[d("软件许可")])),_:1,__:[24]})):t.row.type==="personnel"?(r(),i(_,{key:2,type:"warning"},{default:a(()=>e[25]||(e[25]=[d("人员费用")])),_:1,__:[25]})):t.row.type==="travel"?(r(),i(_,{key:3,type:"info"},{default:a(()=>e[26]||(e[26]=[d("差旅费用")])),_:1,__:[26]})):(r(),i(_,{key:4,type:"default"},{default:a(()=>e[27]||(e[27]=[d("其他费用")])),_:1,__:[27]}))]),_:1}),l(h,{prop:"amount",label:"金额","min-width":"120"},{default:a(t=>[s("span",De,"¥"+v(t.row.amount.toLocaleString()),1)]),_:1}),l(h,{prop:"status",label:"状态","min-width":"100"},{default:a(t=>[t.row.status==="pending"?(r(),i(_,{key:0,type:"warning"},{default:a(()=>e[28]||(e[28]=[d("待审批")])),_:1,__:[28]})):t.row.status==="approved"?(r(),i(_,{key:1,type:"success"},{default:a(()=>e[29]||(e[29]=[d("已通过")])),_:1,__:[29]})):t.row.status==="rejected"?(r(),i(_,{key:2,type:"danger"},{default:a(()=>e[30]||(e[30]=[d("已拒绝")])),_:1,__:[30]})):t.row.status==="paid"?(r(),i(_,{key:3,type:"primary"},{default:a(()=>e[31]||(e[31]=[d("已支付")])),_:1,__:[31]})):$("",!0)]),_:1}),l(h,{prop:"applicant",label:"申请人","min-width":"120"}),l(h,{prop:"department",label:"部门","min-width":"120"}),l(h,{prop:"applyTime",label:"申请时间","min-width":"150"}),l(h,{prop:"approver",label:"审批人","min-width":"120"}),l(h,{label:"操作","min-width":"200",fixed:"right"},{default:a(t=>[l(p,{size:"small",type:"primary",onClick:N=>A(t.row)},{default:a(()=>e[32]||(e[32]=[d("查看")])),_:2,__:[32]},1032,["onClick"]),t.row.status==="pending"?(r(),i(p,{key:0,size:"small",type:"success",onClick:N=>re(t.row)},{default:a(()=>e[33]||(e[33]=[d("审批")])),_:2,__:[33]},1032,["onClick"])):$("",!0),t.row.status==="approved"?(r(),i(p,{key:1,size:"small",type:"warning",onClick:N=>oe(t.row)},{default:a(()=>e[34]||(e[34]=[d("支付")])),_:2,__:[34]},1032,["onClick"])):$("",!0),l(p,{size:"small",type:"danger",onClick:N=>de(t.row)},{default:a(()=>e[35]||(e[35]=[d("删除")])),_:2,__:[35]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(R,{modelValue:q.value,"onUpdate:modelValue":e[5]||(e[5]=t=>q.value=t),title:"费用详情",width:"900px","before-close":_e},{default:a(()=>[n.value?(r(),D("div",Se,[l(k,{class:"info-card",shadow:"never"},{header:a(()=>[s("div",Fe,[e[37]||(e[37]=s("span",null,"费用信息",-1)),l(p,{type:"primary",size:"small",onClick:e[4]||(e[4]=t=>ue(n.value))},{default:a(()=>e[36]||(e[36]=[d("编辑")])),_:1,__:[36]})])]),default:a(()=>[l(j,{gutter:20},{default:a(()=>[l(m,{span:12},{default:a(()=>[s("div",Me,[e[38]||(e[38]=s("label",null,"项目名称：",-1)),s("span",null,v(n.value.projectName),1)])]),_:1}),l(m,{span:12},{default:a(()=>[s("div",Pe,[e[44]||(e[44]=s("label",null,"费用类型：",-1)),n.value.type==="equipment"?(r(),i(_,{key:0,type:"primary"},{default:a(()=>e[39]||(e[39]=[d("设备采购")])),_:1,__:[39]})):n.value.type==="software"?(r(),i(_,{key:1,type:"success"},{default:a(()=>e[40]||(e[40]=[d("软件许可")])),_:1,__:[40]})):n.value.type==="personnel"?(r(),i(_,{key:2,type:"warning"},{default:a(()=>e[41]||(e[41]=[d("人员费用")])),_:1,__:[41]})):n.value.type==="travel"?(r(),i(_,{key:3,type:"info"},{default:a(()=>e[42]||(e[42]=[d("差旅费用")])),_:1,__:[42]})):(r(),i(_,{key:4,type:"default"},{default:a(()=>e[43]||(e[43]=[d("其他费用")])),_:1,__:[43]}))])]),_:1})]),_:1}),l(j,{gutter:20},{default:a(()=>[l(m,{span:12},{default:a(()=>[s("div",Ie,[e[45]||(e[45]=s("label",null,"申请金额：",-1)),s("span",Je,"¥"+v(n.value.amount.toLocaleString()),1)])]),_:1}),l(m,{span:12},{default:a(()=>[s("div",Ke,[e[50]||(e[50]=s("label",null,"状态：",-1)),n.value.status==="pending"?(r(),i(_,{key:0,type:"warning"},{default:a(()=>e[46]||(e[46]=[d("待审批")])),_:1,__:[46]})):n.value.status==="approved"?(r(),i(_,{key:1,type:"success"},{default:a(()=>e[47]||(e[47]=[d("已通过")])),_:1,__:[47]})):n.value.status==="rejected"?(r(),i(_,{key:2,type:"danger"},{default:a(()=>e[48]||(e[48]=[d("已拒绝")])),_:1,__:[48]})):n.value.status==="paid"?(r(),i(_,{key:3,type:"primary"},{default:a(()=>e[49]||(e[49]=[d("已支付")])),_:1,__:[49]})):$("",!0)])]),_:1})]),_:1}),l(j,{gutter:20},{default:a(()=>[l(m,{span:12},{default:a(()=>[s("div",Ae,[e[51]||(e[51]=s("label",null,"申请人：",-1)),s("span",null,v(n.value.applicant),1)])]),_:1}),l(m,{span:12},{default:a(()=>[s("div",He,[e[52]||(e[52]=s("label",null,"申请时间：",-1)),s("span",null,v(n.value.applyTime),1)])]),_:1})]),_:1}),l(j,{gutter:20},{default:a(()=>[l(m,{span:24},{default:a(()=>[s("div",We,[e[53]||(e[53]=s("label",null,"费用说明：",-1)),s("div",Ge,v(n.value.description),1)])]),_:1})]),_:1})]),_:1}),l(k,{class:"approval-card",shadow:"never"},{header:a(()=>e[54]||(e[54]=[s("div",{class:"card-header"},[s("span",null,"审批记录")],-1)])),default:a(()=>[l(he,null,{default:a(()=>[(r(!0),D($e,null,qe(I.value,(t,N)=>(r(),i(be,{key:N,timestamp:t.time,type:t.type==="approve"?"success":t.type==="reject"?"danger":"primary"},{default:a(()=>[s("div",Ee,[s("div",Oe,v(t.action),1),s("div",Qe,v(t.user)+" ("+v(t.department)+")",1),t.comment?(r(),D("div",Xe,v(t.comment),1)):$("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})])):$("",!0)]),_:1},8,["modelValue"]),l(R,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=t=>V.value=t),title:z.value,width:"800px","before-close":ve},{footer:a(()=>[s("div",Ze,[l(p,{onClick:e[10]||(e[10]=t=>V.value=!1)},{default:a(()=>e[57]||(e[57]=[d("取消")])),_:1,__:[57]}),l(p,{type:"primary",onClick:se},{default:a(()=>e[58]||(e[58]=[d("提交申请")])),_:1,__:[58]})])]),default:a(()=>[l(W,{model:b.value,rules:O,ref_key:"expenseFormRef",ref:S,"label-width":"120px"},{default:a(()=>[l(U,{label:"项目名称",prop:"projectName"},{default:a(()=>[l(C,{modelValue:b.value.projectName,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value.projectName=t),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),l(U,{label:"费用类型",prop:"type"},{default:a(()=>[l(K,{modelValue:b.value.type,"onUpdate:modelValue":e[7]||(e[7]=t=>b.value.type=t),placeholder:"请选择费用类型",style:{width:"100%"}},{default:a(()=>[l(f,{label:"设备采购",value:"equipment"}),l(f,{label:"软件许可",value:"software"}),l(f,{label:"人员费用",value:"personnel"}),l(f,{label:"差旅费用",value:"travel"}),l(f,{label:"其他费用",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(U,{label:"申请金额",prop:"amount"},{default:a(()=>[l(ke,{modelValue:b.value.amount,"onUpdate:modelValue":e[8]||(e[8]=t=>b.value.amount=t),min:0,precision:2,step:100,style:{width:"100%"},placeholder:"请输入金额"},null,8,["modelValue"])]),_:1}),l(U,{label:"费用说明",prop:"description"},{default:a(()=>[l(C,{modelValue:b.value.description,"onUpdate:modelValue":e[9]||(e[9]=t=>b.value.description=t),type:"textarea",rows:4,placeholder:"请详细说明费用用途和必要性"},null,8,["modelValue"])]),_:1}),l(U,{label:"附件"},{default:a(()=>[l(Ve,{class:"upload-demo",action:"#","auto-upload":!1,"on-change":me,"file-list":M.value,multiple:""},{tip:a(()=>e[56]||(e[56]=[s("div",{class:"el-upload__tip"}," 支持jpg/png/pdf/doc/docx文件，且不超过10MB ",-1)])),default:a(()=>[l(p,{type:"primary"},{default:a(()=>e[55]||(e[55]=[d("选择文件")])),_:1,__:[55]})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(R,{modelValue:T.value,"onUpdate:modelValue":e[15]||(e[15]=t=>T.value=t),title:"费用审批",width:"600px","before-close":fe},{footer:a(()=>[s("div",ea,[l(p,{onClick:e[14]||(e[14]=t=>T.value=!1)},{default:a(()=>e[61]||(e[61]=[d("取消")])),_:1,__:[61]}),l(p,{type:"primary",onClick:pe},{default:a(()=>e[62]||(e[62]=[d("确认审批")])),_:1,__:[62]})])]),default:a(()=>[l(W,{model:x.value,rules:Q,ref_key:"approvalFormRef",ref:F,"label-width":"100px"},{default:a(()=>[l(U,{label:"审批结果",prop:"result"},{default:a(()=>[l(xe,{modelValue:x.value.result,"onUpdate:modelValue":e[12]||(e[12]=t=>x.value.result=t)},{default:a(()=>[l(G,{label:"approve"},{default:a(()=>e[59]||(e[59]=[d("通过")])),_:1,__:[59]}),l(G,{label:"reject"},{default:a(()=>e[60]||(e[60]=[d("拒绝")])),_:1,__:[60]})]),_:1},8,["modelValue"])]),_:1}),l(U,{label:"审批意见",prop:"comment"},{default:a(()=>[l(C,{modelValue:x.value.comment,"onUpdate:modelValue":e[13]||(e[13]=t=>x.value.comment=t),type:"textarea",rows:4,placeholder:"请输入审批意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(R,{modelValue:Y.value,"onUpdate:modelValue":e[16]||(e[16]=t=>Y.value=t),title:"费用统计",width:"1000px","before-close":ye},{default:a(()=>[s("div",aa,[l(j,{gutter:20,style:{"margin-bottom":"30px"}},{default:a(()=>[l(m,{span:6},{default:a(()=>[l(k,{class:"stat-card"},{default:a(()=>[s("div",la,"¥"+v(X.value.toLocaleString()),1),e[63]||(e[63]=s("div",{class:"stat-label"},"总费用",-1))]),_:1,__:[63]})]),_:1}),l(m,{span:6},{default:a(()=>[l(k,{class:"stat-card"},{default:a(()=>[s("div",ta,v(Z.value),1),e[64]||(e[64]=s("div",{class:"stat-label"},"待审批",-1))]),_:1,__:[64]})]),_:1}),l(m,{span:6},{default:a(()=>[l(k,{class:"stat-card"},{default:a(()=>[s("div",ua,v(ee.value),1),e[65]||(e[65]=s("div",{class:"stat-label"},"已通过",-1))]),_:1,__:[65]})]),_:1}),l(m,{span:6},{default:a(()=>[l(k,{class:"stat-card"},{default:a(()=>[s("div",sa,v(ae.value),1),e[66]||(e[66]=s("div",{class:"stat-label"},"已支付",-1))]),_:1,__:[66]})]),_:1})]),_:1}),l(j,{gutter:20},{default:a(()=>[l(m,{span:12},{default:a(()=>[l(k,null,{header:a(()=>e[67]||(e[67]=[d("费用类型分布")])),default:a(()=>[e[68]||(e[68]=s("div",{id:"typeChart",style:{height:"300px"}},null,-1))]),_:1,__:[68]})]),_:1}),l(m,{span:12},{default:a(()=>[l(k,null,{header:a(()=>e[69]||(e[69]=[d("月度费用趋势")])),default:a(()=>[e[70]||(e[70]=s("div",{id:"trendChart",style:{height:"300px"}},null,-1))]),_:1,__:[70]})]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}},oa=Ce(da,[["__scopeId","data-v-e17a1278"]]);export{oa as default};
