import{_ as je,r as g,l as z,o as Ne,c as L,b as l,w as t,E as b,d,e as u,a as o,g as n,y as Ee,u as Fe,z as Re,t as _,i as p,j as T,F as Te,f as Ue,k as Q}from"./index-GFMf_6Qi.js";const qe={class:"rd-expense-container"},De={class:"header"},$e={class:"header-actions"},Be={class:"search-section"},ze=["onClick"],Le={class:"amount"},Se={key:0,class:"expense-detail"},Me={class:"card-header"},Ye={class:"detail-item"},Ae={class:"detail-item"},Ie={class:"detail-item"},Pe={class:"amount"},Ke={class:"detail-item"},Ge={class:"detail-item"},He={class:"detail-item"},Je={class:"detail-item"},Oe={class:"content-text"},Qe={class:"timeline-content"},We={class:"timeline-title"},Xe={class:"timeline-user"},Ze={key:0,class:"timeline-comment"},he={class:"dialog-footer"},et={class:"dialog-footer"},tt={class:"statistics-content"},lt={class:"stat-number"},at={class:"stat-number"},st={class:"stat-number"},ot={class:"stat-number"},nt={__name:"expense-rd",setup(ut){const w=g([]),U=g(!1),i=g(null),V=g(!1),q=g("申请费用"),S=g(null),F=g(!1),M=g(null),D=g(!1),Y=g([]),m=g({keyword:"",status:"",type:"",dateRange:[]}),A=[{id:"exp001",projectName:"AI算法优化项目",type:"equipment",amount:5e4,status:"pending",applicant:"张工程师",department:"技术部",applyTime:"2024-01-15 09:00:00",approver:"",description:"购买高性能GPU服务器用于AI模型训练，提升算法性能。"},{id:"exp002",projectName:"移动端开发项目",type:"software",amount:15e3,status:"approved",applicant:"李开发",department:"技术部",applyTime:"2024-01-14 14:30:00",approver:"王经理",description:"购买移动端开发工具和第三方SDK授权。"},{id:"exp003",projectName:"产品设计项目",type:"personnel",amount:8e3,status:"paid",applicant:"陈设计师",department:"设计部",applyTime:"2024-01-13 11:20:00",approver:"刘总监",description:"外聘专业设计师进行产品界面设计。"},{id:"exp004",projectName:"技术交流会议",type:"travel",amount:3e3,status:"rejected",applicant:"赵研究员",department:"研发部",applyTime:"2024-01-12 16:45:00",approver:"孙经理",description:"参加行业技术交流会议，包括差旅费和会议费。"}],I=g([{action:"提交申请",user:"张工程师",department:"技术部",time:"2024-01-15 09:00:00",type:"submit"}]),c=g({projectName:"",type:"",amount:0,description:""}),C=g({result:"approve",comment:""}),W={projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],type:[{required:!0,message:"请选择费用类型",trigger:"change"}],amount:[{required:!0,message:"请输入申请金额",trigger:"blur"}],description:[{required:!0,message:"请输入费用说明",trigger:"blur"}]},X={result:[{required:!0,message:"请选择审批结果",trigger:"change"}],comment:[{required:!0,message:"请输入审批意见",trigger:"blur"}]},Z=z(()=>w.value.reduce((s,e)=>s+e.amount,0)),h=z(()=>w.value.filter(s=>s.status==="pending").length),ee=z(()=>w.value.filter(s=>s.status==="approved").length),te=z(()=>w.value.filter(s=>s.status==="paid").length),$=async()=>{try{await new Promise(s=>setTimeout(s,500)),w.value=A,b.success("费用列表加载成功")}catch{b.error("获取费用列表失败")}},le=()=>{$()},ae=()=>{q.value="申请费用",c.value={projectName:"",type:"",amount:0,description:""},Y.value=[],V.value=!0},se=s=>{q.value="编辑费用",c.value={...s},V.value=!0},oe=async()=>{try{await S.value.validate(),await new Promise(s=>setTimeout(s,1e3)),b.success(q.value==="申请费用"?"费用申请提交成功":"费用信息更新成功"),V.value=!1,$()}catch{b.error("表单验证失败")}},ne=async s=>{try{await Q.confirm(`确定要删除费用申请"${s.projectName}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),w.value=w.value.filter(e=>e.id!==s.id),b.success("删除成功")}catch{b.info("已取消删除")}},G=s=>{i.value=s,U.value=!0,me(s.id)},ue=s=>{i.value=s,C.value={result:"approve",comment:""},F.value=!0},re=async()=>{try{await M.value.validate(),await new Promise(e=>setTimeout(e,1e3));const s=w.value.find(e=>e.id===i.value.id);s&&(s.status=C.value.result==="approve"?"approved":"rejected",s.approver="当前用户"),b.success("审批完成"),F.value=!1,$()}catch{b.error("表单验证失败")}},de=async s=>{try{await Q.confirm(`确定要支付费用"${s.projectName}"吗？`,"确认支付",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.status="paid",b.success("支付成功")}catch{b.info("已取消支付")}},pe=()=>{D.value=!0},H=()=>{console.log("搜索条件:",m.value);let s=[...A];if(m.value.keyword){const e=m.value.keyword.toLowerCase();s=s.filter(r=>r.projectName.toLowerCase().includes(e)||r.applicant.toLowerCase().includes(e)||r.department.toLowerCase().includes(e))}if(m.value.status&&(s=s.filter(e=>e.status===m.value.status)),m.value.type&&(s=s.filter(e=>e.type===m.value.type)),m.value.dateRange&&m.value.dateRange.length===2){const[e,r]=m.value.dateRange;s=s.filter(P=>{const j=P.applyTime.split(" ")[0];return j>=e&&j<=r})}w.value=s,s.length===0?b.info("没有找到匹配的费用记录"):b.success(`找到 ${s.length} 条费用记录`)},ie=()=>{m.value={keyword:"",status:"",type:"",dateRange:[]},w.value=[...A],b.success("搜索条件已重置")},me=s=>{I.value=[{action:"提交申请",user:"张工程师",department:"技术部",time:"2024-01-15 09:00:00",type:"submit"}]},ve=(s,e)=>{console.log("文件变化:",s,e)},fe=()=>{U.value=!1,i.value=null,I.value=[]},_e=()=>{var s;V.value=!1,(s=S.value)==null||s.resetFields(),Y.value=[]},ye=()=>{var s;F.value=!1,(s=M.value)==null||s.resetFields()},ge=()=>{D.value=!1};return Ne($),(s,e)=>{const r=d("el-button"),P=d("el-icon"),j=d("el-input"),v=d("el-col"),y=d("el-option"),K=d("el-select"),be=d("el-date-picker"),N=d("el-row"),k=d("el-table-column"),f=d("el-tag"),we=d("el-table"),x=d("el-card"),ce=d("el-timeline-item"),ke=d("el-timeline"),B=d("el-dialog"),E=d("el-form-item"),xe=d("el-input-number"),Ve=d("el-upload"),J=d("el-form"),O=d("el-radio"),Ce=d("el-radio-group");return u(),L("div",qe,[l(x,null,{default:t(()=>[o("div",De,[e[20]||(e[20]=o("span",null,"研发费用管理",-1)),o("div",$e,[l(r,{type:"primary",onClick:ae,size:"small"},{default:t(()=>e[17]||(e[17]=[n("申请费用")])),_:1,__:[17]}),l(r,{type:"success",onClick:le,size:"small"},{default:t(()=>e[18]||(e[18]=[n("刷新")])),_:1,__:[18]}),l(r,{type:"info",onClick:pe,size:"small"},{default:t(()=>e[19]||(e[19]=[n("费用统计")])),_:1,__:[19]})])]),o("div",Be,[l(N,{gutter:20},{default:t(()=>[l(v,{span:6},{default:t(()=>[l(j,{modelValue:m.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value.keyword=a),placeholder:"搜索项目名称或申请人",clearable:"",onKeyup:Ee(H,["enter"])},{prefix:t(()=>[l(P,null,{default:t(()=>[l(Fe(Re))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{span:4},{default:t(()=>[l(K,{modelValue:m.value.status,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value.status=a),placeholder:"状态",clearable:""},{default:t(()=>[l(y,{label:"待审批",value:"pending"}),l(y,{label:"已通过",value:"approved"}),l(y,{label:"已拒绝",value:"rejected"}),l(y,{label:"已支付",value:"paid"})]),_:1},8,["modelValue"])]),_:1}),l(v,{span:4},{default:t(()=>[l(K,{modelValue:m.value.type,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value.type=a),placeholder:"费用类型",clearable:""},{default:t(()=>[l(y,{label:"设备采购",value:"equipment"}),l(y,{label:"软件许可",value:"software"}),l(y,{label:"人员费用",value:"personnel"}),l(y,{label:"差旅费用",value:"travel"}),l(y,{label:"其他费用",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(v,{span:6},{default:t(()=>[l(be,{modelValue:m.value.dateRange,"onUpdate:modelValue":e[3]||(e[3]=a=>m.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(v,{span:4},{default:t(()=>[l(r,{type:"primary",onClick:H},{default:t(()=>e[21]||(e[21]=[n("搜索")])),_:1,__:[21]}),l(r,{onClick:ie},{default:t(()=>e[22]||(e[22]=[n("重置")])),_:1,__:[22]})]),_:1})]),_:1})]),l(we,{data:w.value,style:{width:"100%","margin-top":"20px"},fit:"true"},{default:t(()=>[l(k,{prop:"projectName",label:"项目名称","min-width":"150"},{default:t(a=>[o("span",{class:"clickable-title",onClick:R=>G(a.row)},_(a.row.projectName),9,ze)]),_:1}),l(k,{prop:"type",label:"费用类型","min-width":"120"},{default:t(a=>[a.row.type==="equipment"?(u(),p(f,{key:0,type:"primary"},{default:t(()=>e[23]||(e[23]=[n("设备采购")])),_:1,__:[23]})):a.row.type==="software"?(u(),p(f,{key:1,type:"success"},{default:t(()=>e[24]||(e[24]=[n("软件许可")])),_:1,__:[24]})):a.row.type==="personnel"?(u(),p(f,{key:2,type:"warning"},{default:t(()=>e[25]||(e[25]=[n("人员费用")])),_:1,__:[25]})):a.row.type==="travel"?(u(),p(f,{key:3,type:"info"},{default:t(()=>e[26]||(e[26]=[n("差旅费用")])),_:1,__:[26]})):(u(),p(f,{key:4,type:"default"},{default:t(()=>e[27]||(e[27]=[n("其他费用")])),_:1,__:[27]}))]),_:1}),l(k,{prop:"amount",label:"金额","min-width":"120"},{default:t(a=>[o("span",Le,"¥"+_(a.row.amount.toLocaleString()),1)]),_:1}),l(k,{prop:"status",label:"状态","min-width":"100"},{default:t(a=>[a.row.status==="pending"?(u(),p(f,{key:0,type:"warning"},{default:t(()=>e[28]||(e[28]=[n("待审批")])),_:1,__:[28]})):a.row.status==="approved"?(u(),p(f,{key:1,type:"success"},{default:t(()=>e[29]||(e[29]=[n("已通过")])),_:1,__:[29]})):a.row.status==="rejected"?(u(),p(f,{key:2,type:"danger"},{default:t(()=>e[30]||(e[30]=[n("已拒绝")])),_:1,__:[30]})):a.row.status==="paid"?(u(),p(f,{key:3,type:"primary"},{default:t(()=>e[31]||(e[31]=[n("已支付")])),_:1,__:[31]})):T("",!0)]),_:1}),l(k,{prop:"applicant",label:"申请人","min-width":"120"}),l(k,{prop:"department",label:"部门","min-width":"120"}),l(k,{prop:"applyTime",label:"申请时间","min-width":"150"}),l(k,{prop:"approver",label:"审批人","min-width":"120"}),l(k,{label:"操作","min-width":"200",fixed:"right"},{default:t(a=>[l(r,{size:"small",type:"primary",onClick:R=>G(a.row)},{default:t(()=>e[32]||(e[32]=[n("查看")])),_:2,__:[32]},1032,["onClick"]),a.row.status==="pending"?(u(),p(r,{key:0,size:"small",type:"success",onClick:R=>ue(a.row)},{default:t(()=>e[33]||(e[33]=[n("审批")])),_:2,__:[33]},1032,["onClick"])):T("",!0),a.row.status==="approved"?(u(),p(r,{key:1,size:"small",type:"warning",onClick:R=>de(a.row)},{default:t(()=>e[34]||(e[34]=[n("支付")])),_:2,__:[34]},1032,["onClick"])):T("",!0),l(r,{size:"small",type:"danger",onClick:R=>ne(a.row)},{default:t(()=>e[35]||(e[35]=[n("删除")])),_:2,__:[35]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(B,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=a=>U.value=a),title:"费用详情",width:"900px","before-close":fe},{default:t(()=>[i.value?(u(),L("div",Se,[l(x,{class:"info-card",shadow:"never"},{header:t(()=>[o("div",Me,[e[37]||(e[37]=o("span",null,"费用信息",-1)),l(r,{type:"primary",size:"small",onClick:e[4]||(e[4]=a=>se(i.value))},{default:t(()=>e[36]||(e[36]=[n("编辑")])),_:1,__:[36]})])]),default:t(()=>[l(N,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[o("div",Ye,[e[38]||(e[38]=o("label",null,"项目名称：",-1)),o("span",null,_(i.value.projectName),1)])]),_:1}),l(v,{span:12},{default:t(()=>[o("div",Ae,[e[44]||(e[44]=o("label",null,"费用类型：",-1)),i.value.type==="equipment"?(u(),p(f,{key:0,type:"primary"},{default:t(()=>e[39]||(e[39]=[n("设备采购")])),_:1,__:[39]})):i.value.type==="software"?(u(),p(f,{key:1,type:"success"},{default:t(()=>e[40]||(e[40]=[n("软件许可")])),_:1,__:[40]})):i.value.type==="personnel"?(u(),p(f,{key:2,type:"warning"},{default:t(()=>e[41]||(e[41]=[n("人员费用")])),_:1,__:[41]})):i.value.type==="travel"?(u(),p(f,{key:3,type:"info"},{default:t(()=>e[42]||(e[42]=[n("差旅费用")])),_:1,__:[42]})):(u(),p(f,{key:4,type:"default"},{default:t(()=>e[43]||(e[43]=[n("其他费用")])),_:1,__:[43]}))])]),_:1})]),_:1}),l(N,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[o("div",Ie,[e[45]||(e[45]=o("label",null,"申请金额：",-1)),o("span",Pe,"¥"+_(i.value.amount.toLocaleString()),1)])]),_:1}),l(v,{span:12},{default:t(()=>[o("div",Ke,[e[50]||(e[50]=o("label",null,"状态：",-1)),i.value.status==="pending"?(u(),p(f,{key:0,type:"warning"},{default:t(()=>e[46]||(e[46]=[n("待审批")])),_:1,__:[46]})):i.value.status==="approved"?(u(),p(f,{key:1,type:"success"},{default:t(()=>e[47]||(e[47]=[n("已通过")])),_:1,__:[47]})):i.value.status==="rejected"?(u(),p(f,{key:2,type:"danger"},{default:t(()=>e[48]||(e[48]=[n("已拒绝")])),_:1,__:[48]})):i.value.status==="paid"?(u(),p(f,{key:3,type:"primary"},{default:t(()=>e[49]||(e[49]=[n("已支付")])),_:1,__:[49]})):T("",!0)])]),_:1})]),_:1}),l(N,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[o("div",Ge,[e[51]||(e[51]=o("label",null,"申请人：",-1)),o("span",null,_(i.value.applicant),1)])]),_:1}),l(v,{span:12},{default:t(()=>[o("div",He,[e[52]||(e[52]=o("label",null,"申请时间：",-1)),o("span",null,_(i.value.applyTime),1)])]),_:1})]),_:1}),l(N,{gutter:20},{default:t(()=>[l(v,{span:24},{default:t(()=>[o("div",Je,[e[53]||(e[53]=o("label",null,"费用说明：",-1)),o("div",Oe,_(i.value.description),1)])]),_:1})]),_:1})]),_:1}),l(x,{class:"approval-card",shadow:"never"},{header:t(()=>e[54]||(e[54]=[o("div",{class:"card-header"},[o("span",null,"审批记录")],-1)])),default:t(()=>[l(ke,null,{default:t(()=>[(u(!0),L(Te,null,Ue(I.value,(a,R)=>(u(),p(ce,{key:R,timestamp:a.time,type:a.type==="approve"?"success":a.type==="reject"?"danger":"primary"},{default:t(()=>[o("div",Qe,[o("div",We,_(a.action),1),o("div",Xe,_(a.user)+" ("+_(a.department)+")",1),a.comment?(u(),L("div",Ze,_(a.comment),1)):T("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})])):T("",!0)]),_:1},8,["modelValue"]),l(B,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=a=>V.value=a),title:q.value,width:"800px","before-close":_e},{footer:t(()=>[o("div",he,[l(r,{onClick:e[10]||(e[10]=a=>V.value=!1)},{default:t(()=>e[57]||(e[57]=[n("取消")])),_:1,__:[57]}),l(r,{type:"primary",onClick:oe},{default:t(()=>e[58]||(e[58]=[n("提交申请")])),_:1,__:[58]})])]),default:t(()=>[l(J,{model:c.value,rules:W,ref_key:"expenseFormRef",ref:S,"label-width":"120px"},{default:t(()=>[l(E,{label:"项目名称",prop:"projectName"},{default:t(()=>[l(j,{modelValue:c.value.projectName,"onUpdate:modelValue":e[6]||(e[6]=a=>c.value.projectName=a),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),l(E,{label:"费用类型",prop:"type"},{default:t(()=>[l(K,{modelValue:c.value.type,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value.type=a),placeholder:"请选择费用类型",style:{width:"100%"}},{default:t(()=>[l(y,{label:"设备采购",value:"equipment"}),l(y,{label:"软件许可",value:"software"}),l(y,{label:"人员费用",value:"personnel"}),l(y,{label:"差旅费用",value:"travel"}),l(y,{label:"其他费用",value:"other"})]),_:1},8,["modelValue"])]),_:1}),l(E,{label:"申请金额",prop:"amount"},{default:t(()=>[l(xe,{modelValue:c.value.amount,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value.amount=a),min:0,precision:2,step:100,style:{width:"100%"},placeholder:"请输入金额"},null,8,["modelValue"])]),_:1}),l(E,{label:"费用说明",prop:"description"},{default:t(()=>[l(j,{modelValue:c.value.description,"onUpdate:modelValue":e[9]||(e[9]=a=>c.value.description=a),type:"textarea",rows:4,placeholder:"请详细说明费用用途和必要性"},null,8,["modelValue"])]),_:1}),l(E,{label:"附件"},{default:t(()=>[l(Ve,{class:"upload-demo",action:"#","auto-upload":!1,"on-change":ve,"file-list":Y.value,multiple:""},{tip:t(()=>e[56]||(e[56]=[o("div",{class:"el-upload__tip"}," 支持jpg/png/pdf/doc/docx文件，且不超过10MB ",-1)])),default:t(()=>[l(r,{type:"primary"},{default:t(()=>e[55]||(e[55]=[n("选择文件")])),_:1,__:[55]})]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(B,{modelValue:F.value,"onUpdate:modelValue":e[15]||(e[15]=a=>F.value=a),title:"费用审批",width:"600px","before-close":ye},{footer:t(()=>[o("div",et,[l(r,{onClick:e[14]||(e[14]=a=>F.value=!1)},{default:t(()=>e[61]||(e[61]=[n("取消")])),_:1,__:[61]}),l(r,{type:"primary",onClick:re},{default:t(()=>e[62]||(e[62]=[n("确认审批")])),_:1,__:[62]})])]),default:t(()=>[l(J,{model:C.value,rules:X,ref_key:"approvalFormRef",ref:M,"label-width":"100px"},{default:t(()=>[l(E,{label:"审批结果",prop:"result"},{default:t(()=>[l(Ce,{modelValue:C.value.result,"onUpdate:modelValue":e[12]||(e[12]=a=>C.value.result=a)},{default:t(()=>[l(O,{label:"approve"},{default:t(()=>e[59]||(e[59]=[n("通过")])),_:1,__:[59]}),l(O,{label:"reject"},{default:t(()=>e[60]||(e[60]=[n("拒绝")])),_:1,__:[60]})]),_:1},8,["modelValue"])]),_:1}),l(E,{label:"审批意见",prop:"comment"},{default:t(()=>[l(j,{modelValue:C.value.comment,"onUpdate:modelValue":e[13]||(e[13]=a=>C.value.comment=a),type:"textarea",rows:4,placeholder:"请输入审批意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(B,{modelValue:D.value,"onUpdate:modelValue":e[16]||(e[16]=a=>D.value=a),title:"费用统计",width:"1000px","before-close":ge},{default:t(()=>[o("div",tt,[l(N,{gutter:20,style:{"margin-bottom":"30px"}},{default:t(()=>[l(v,{span:6},{default:t(()=>[l(x,{class:"stat-card"},{default:t(()=>[o("div",lt,"¥"+_(Z.value.toLocaleString()),1),e[63]||(e[63]=o("div",{class:"stat-label"},"总费用",-1))]),_:1,__:[63]})]),_:1}),l(v,{span:6},{default:t(()=>[l(x,{class:"stat-card"},{default:t(()=>[o("div",at,_(h.value),1),e[64]||(e[64]=o("div",{class:"stat-label"},"待审批",-1))]),_:1,__:[64]})]),_:1}),l(v,{span:6},{default:t(()=>[l(x,{class:"stat-card"},{default:t(()=>[o("div",st,_(ee.value),1),e[65]||(e[65]=o("div",{class:"stat-label"},"已通过",-1))]),_:1,__:[65]})]),_:1}),l(v,{span:6},{default:t(()=>[l(x,{class:"stat-card"},{default:t(()=>[o("div",ot,_(te.value),1),e[66]||(e[66]=o("div",{class:"stat-label"},"已支付",-1))]),_:1,__:[66]})]),_:1})]),_:1}),l(N,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[l(x,null,{header:t(()=>e[67]||(e[67]=[n("费用类型分布")])),default:t(()=>[e[68]||(e[68]=o("div",{id:"typeChart",style:{height:"300px"}},null,-1))]),_:1,__:[68]})]),_:1}),l(v,{span:12},{default:t(()=>[l(x,null,{header:t(()=>e[69]||(e[69]=[n("月度费用趋势")])),default:t(()=>[e[70]||(e[70]=o("div",{id:"trendChart",style:{height:"300px"}},null,-1))]),_:1,__:[70]})]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}},dt=je(nt,[["__scopeId","data-v-e17a1278"]]);export{dt as default};
