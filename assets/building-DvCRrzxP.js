import{ref as e,reactive as l,computed as a,onMounted as t,resolveComponent as d,resolveDirective as o,openBlock as i,createElementBlock as u,createElementVNode as n,createVNode as r,withCtx as s,unref as p,createTextVNode as c,withKeys as m,withDirectives as f,createBlock as _,toDisplayString as g,createCommentVNode as v,nextTick as b}from"vue";import{ElMessageBox as y,ElMessage as h}from"element-plus";import{J as w,F as V}from"./index-BOpLbFaH.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";const C={class:"building-container"},k={class:"page-header"},U={class:"search-section"},D={class:"building-list"},S={class:"pagination-container"},z={class:"dialog-footer"},T={key:0,class:"building-detail"},B={class:"dialog-footer"},M={key:0,style:{"margin-top":"16px"}},O={key:1,style:{"margin-top":"24px"}},q=x({__name:"building",setup(x){const q=e(!1),I=e(!1),P=e(!1),j=e(!1),J=e(),L=e(null),Z=e(!1),$=l({start:"",end:""}),A=e(""),F=e([]),N=l({name:"",status:"",type:""}),R=l({currentPage:1,pageSize:10,total:0}),W=l({id:null,name:"",type:"",address:"",floors:1,area:0,status:"normal",buildDate:"",description:""}),E={name:[{required:!0,message:"请输入建筑名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择建筑类型",trigger:"change"}],address:[{required:!0,message:"请输入建筑地址",trigger:"blur"}],floors:[{required:!0,message:"请输入楼层数",trigger:"blur"}],area:[{required:!0,message:"请输入建筑面积",trigger:"blur"}],status:[{required:!0,message:"请选择建筑状态",trigger:"change"}],buildDate:[{required:!0,message:"请选择建成日期",trigger:"change"}]},G=e([{id:1,name:"益客大厦A座",type:"office",address:"北京市朝阳区建国路88号",floors:25,area:15000.5,status:"normal",buildDate:"2020-06-15",description:"现代化办公大楼，配套设施完善",createTime:"2020-01-01 10:00:00"},{id:2,name:"益客住宅小区",type:"residential",address:"北京市海淀区中关村大街100号",floors:18,area:25e3,status:"normal",buildDate:"2019-12-01",description:"高品质住宅小区，环境优美",createTime:"2019-06-01 10:00:00"},{id:3,name:"益客商业中心",type:"commercial",address:"北京市西城区西单大街200号",floors:12,area:18e3,status:"maintenance",buildDate:"2018-08-20",description:"综合性商业中心，交通便利",createTime:"2018-03-01 10:00:00"}]),K=a((()=>W.id?"编辑建筑":"添加建筑")),H=e=>({office:"办公楼",residential:"住宅楼",commercial:"商业楼",industrial:"工业建筑"}[e]||"未知"),Q=e=>({office:"primary",residential:"success",commercial:"warning",industrial:"info"}[e]||""),X=e=>({normal:"正常",maintenance:"维护中",disabled:"停用"}[e]||"未知"),Y=e=>({normal:"success",maintenance:"warning",disabled:"danger"}[e]||""),ee=()=>{W.id=null,P.value=!0},le=async()=>{if(J.value)try{if(await J.value.validate(),I.value=!0,await new Promise((e=>setTimeout(e,1e3))),W.id){const e=G.value.findIndex((e=>e.id===W.id));e>-1&&(G.value[e]={...W}),h.success("编辑成功")}else{const e={...W,id:Date.now(),createTime:(new Date).toLocaleString()};G.value.unshift(e),h.success("添加成功")}P.value=!1,ae()}catch(e){}finally{I.value=!1}},ae=()=>{J.value&&J.value.resetFields(),Object.assign(W,{id:null,name:"",type:"",address:"",floors:1,area:0,status:"normal",buildDate:"",description:""})},te=()=>{R.currentPage=1},de=()=>{Object.assign(N,{name:"",status:"",type:""}),te()},oe=e=>{R.pageSize=e},ie=e=>{R.currentPage=e};function ue(){var e;$.start="",$.end=(null==(e=L.value)?void 0:e.address)||"",A.value="",Z.value=!0,b((()=>{!function(){const e=new window.BMap.Map("baiduMapContainer");e.centerAndZoom($.end||"北京",12),e.enableScrollWheelZoom(!0),e.clearOverlays(),e.addEventListener("click",(function(e){const l=e.point;(new window.BMap.Geocoder).getLocation(l,(function(e){const l=e.address;y({title:"地图点选",message:`将【${l}】设为起点还是终点？`,showCancelButton:!0,confirmButtonText:"起点",cancelButtonText:"终点"}).then((()=>{$.start=l})).catch((()=>{$.end=l}))}))}))}()})),re()}function ne(){if(!$.start||!$.end)return void(A.value="请填写起点和终点");const e=new window.BMap.Map("baiduMapContainer");e.centerAndZoom($.end,14),e.enableScrollWheelZoom(!0);new window.BMap.DrivingRoute(e,{renderOptions:{map:e,autoViewport:!0}}).search($.start,$.end),A.value=`已为您规划从【${$.start}】到【${$.end}】的路径`,function(e){const l="building_route_history";let a=JSON.parse(localStorage.getItem(l)||"[]");a.unshift(e),a.length>10&&(a=a.slice(0,10));localStorage.setItem(l,JSON.stringify(a))}({start:$.start,end:$.end,time:(new Date).toLocaleString()}),re()}function re(){F.value=JSON.parse(localStorage.getItem("building_route_history")||"[]")}return t((()=>{R.total=G.value.length})),(e,l)=>{const a=d("el-icon"),t=d("el-button"),b=d("el-input"),x=d("el-col"),re=d("el-option"),se=d("el-select"),pe=d("el-row"),ce=d("el-table-column"),me=d("el-tag"),fe=d("el-table"),_e=d("el-pagination"),ge=d("el-form-item"),ve=d("el-input-number"),be=d("el-date-picker"),ye=d("el-form"),he=d("el-dialog"),we=d("el-descriptions-item"),Ve=d("el-descriptions"),xe=d("el-alert"),Ce=o("loading");return i(),u("div",C,[n("div",k,[l[21]||(l[21]=n("h2",null,"建筑管理系统",-1)),r(t,{type:"primary",onClick:ee},{default:s((()=>[r(a,null,{default:s((()=>[r(p(w))])),_:1}),l[20]||(l[20]=c(" 添加建筑 "))])),_:1,__:[20]})]),n("div",U,[r(pe,{gutter:20},{default:s((()=>[r(x,{span:6},{default:s((()=>[r(b,{modelValue:N.name,"onUpdate:modelValue":l[0]||(l[0]=e=>N.name=e),placeholder:"建筑名称",clearable:"",onClear:te,onKeyup:m(te,["enter"])},{prefix:s((()=>[r(a,null,{default:s((()=>[r(p(V))])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(x,{span:6},{default:s((()=>[r(se,{modelValue:N.status,"onUpdate:modelValue":l[1]||(l[1]=e=>N.status=e),placeholder:"建筑状态",clearable:"",onChange:te},{default:s((()=>[r(re,{label:"正常",value:"normal"}),r(re,{label:"维护中",value:"maintenance"}),r(re,{label:"停用",value:"disabled"})])),_:1},8,["modelValue"])])),_:1}),r(x,{span:6},{default:s((()=>[r(se,{modelValue:N.type,"onUpdate:modelValue":l[2]||(l[2]=e=>N.type=e),placeholder:"建筑类型",clearable:"",onChange:te},{default:s((()=>[r(re,{label:"办公楼",value:"office"}),r(re,{label:"住宅楼",value:"residential"}),r(re,{label:"商业楼",value:"commercial"}),r(re,{label:"工业建筑",value:"industrial"})])),_:1},8,["modelValue"])])),_:1}),r(x,{span:6},{default:s((()=>[r(t,{type:"primary",onClick:te},{default:s((()=>[r(a,null,{default:s((()=>[r(p(V))])),_:1}),l[22]||(l[22]=c(" 搜索 "))])),_:1,__:[22]}),r(t,{onClick:de},{default:s((()=>l[23]||(l[23]=[c("重置")]))),_:1,__:[23]})])),_:1})])),_:1})]),n("div",D,[f((i(),_(fe,{data:G.value,stripe:""},{default:s((()=>[r(ce,{prop:"id",label:"ID",width:"80"}),r(ce,{prop:"name",label:"建筑名称"}),r(ce,{prop:"type",label:"建筑类型"},{default:s((e=>[r(me,{type:Q(e.row.type)},{default:s((()=>[c(g(H(e.row.type)),1)])),_:2},1032,["type"])])),_:1}),r(ce,{prop:"address",label:"地址"}),r(ce,{prop:"floors",label:"楼层数",width:"100"}),r(ce,{prop:"area",label:"建筑面积(m²)",width:"120"}),r(ce,{prop:"status",label:"状态",width:"100"},{default:s((e=>[r(me,{type:Y(e.row.status)},{default:s((()=>[c(g(X(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),r(ce,{prop:"buildDate",label:"建成日期",width:"120"}),r(ce,{label:"操作",width:"200",fixed:"right"},{default:s((e=>[r(t,{size:"small",onClick:l=>{return a=e.row,L.value=a,void(j.value=!0);var a}},{default:s((()=>l[24]||(l[24]=[c("查看")]))),_:2,__:[24]},1032,["onClick"]),r(t,{size:"small",type:"primary",onClick:l=>{return a=e.row,Object.assign(W,a),void(P.value=!0);var a}},{default:s((()=>l[25]||(l[25]=[c("编辑")]))),_:2,__:[25]},1032,["onClick"]),r(t,{size:"small",type:"danger",onClick:l=>(async e=>{try{await y.confirm(`确定要删除建筑"${e.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=G.value.findIndex((l=>l.id===e.id));l>-1&&(G.value.splice(l,1),h.success("删除成功"))}catch(l){}})(e.row)},{default:s((()=>l[26]||(l[26]=[c("删除")]))),_:2,__:[26]},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Ce,q.value]]),n("div",S,[r(_e,{"current-page":R.currentPage,"onUpdate:currentPage":l[3]||(l[3]=e=>R.currentPage=e),"page-size":R.pageSize,"onUpdate:pageSize":l[4]||(l[4]=e=>R.pageSize=e),"page-sizes":[10,20,50,100],total:R.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),r(he,{modelValue:P.value,"onUpdate:modelValue":l[14]||(l[14]=e=>P.value=e),title:K.value,width:"600px",onClose:ae},{footer:s((()=>[n("div",z,[r(t,{onClick:l[13]||(l[13]=e=>P.value=!1)},{default:s((()=>l[28]||(l[28]=[c("取消")]))),_:1,__:[28]}),r(t,{type:"primary",onClick:le,loading:I.value},{default:s((()=>l[29]||(l[29]=[c("确定")]))),_:1,__:[29]},8,["loading"])])])),default:s((()=>[r(ye,{model:W,rules:E,ref_key:"buildingFormRef",ref:J,"label-width":"100px"},{default:s((()=>[r(ge,{label:"建筑名称",prop:"name"},{default:s((()=>[r(b,{modelValue:W.name,"onUpdate:modelValue":l[5]||(l[5]=e=>W.name=e),placeholder:"请输入建筑名称"},null,8,["modelValue"])])),_:1}),r(ge,{label:"建筑类型",prop:"type"},{default:s((()=>[r(se,{modelValue:W.type,"onUpdate:modelValue":l[6]||(l[6]=e=>W.type=e),placeholder:"请选择建筑类型",style:{width:"100%"}},{default:s((()=>[r(re,{label:"办公楼",value:"office"}),r(re,{label:"住宅楼",value:"residential"}),r(re,{label:"商业楼",value:"commercial"}),r(re,{label:"工业建筑",value:"industrial"})])),_:1},8,["modelValue"])])),_:1}),r(ge,{label:"地址",prop:"address"},{default:s((()=>[r(b,{modelValue:W.address,"onUpdate:modelValue":l[7]||(l[7]=e=>W.address=e),placeholder:"请输入建筑地址"},null,8,["modelValue"])])),_:1}),r(ge,{label:"楼层数",prop:"floors"},{default:s((()=>[r(ve,{modelValue:W.floors,"onUpdate:modelValue":l[8]||(l[8]=e=>W.floors=e),min:1,max:200,style:{width:"100%"}},null,8,["modelValue"])])),_:1}),r(ge,{label:"建筑面积",prop:"area"},{default:s((()=>[r(ve,{modelValue:W.area,"onUpdate:modelValue":l[9]||(l[9]=e=>W.area=e),min:1,precision:2,style:{width:"100%"}},null,8,["modelValue"]),l[27]||(l[27]=n("span",{style:{"margin-left":"10px",color:"#666"}},"m²",-1))])),_:1,__:[27]}),r(ge,{label:"建筑状态",prop:"status"},{default:s((()=>[r(se,{modelValue:W.status,"onUpdate:modelValue":l[10]||(l[10]=e=>W.status=e),placeholder:"请选择建筑状态",style:{width:"100%"}},{default:s((()=>[r(re,{label:"正常",value:"normal"}),r(re,{label:"维护中",value:"maintenance"}),r(re,{label:"停用",value:"disabled"})])),_:1},8,["modelValue"])])),_:1}),r(ge,{label:"建成日期",prop:"buildDate"},{default:s((()=>[r(be,{modelValue:W.buildDate,"onUpdate:modelValue":l[11]||(l[11]=e=>W.buildDate=e),type:"date",placeholder:"选择建成日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),r(ge,{label:"描述",prop:"description"},{default:s((()=>[r(b,{modelValue:W.description,"onUpdate:modelValue":l[12]||(l[12]=e=>W.description=e),type:"textarea",rows:3,placeholder:"请输入建筑描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"]),r(he,{modelValue:j.value,"onUpdate:modelValue":l[16]||(l[16]=e=>j.value=e),title:"建筑详情",width:"800px"},{footer:s((()=>[n("div",B,[r(t,{onClick:l[15]||(l[15]=e=>j.value=!1)},{default:s((()=>l[30]||(l[30]=[c("关闭")]))),_:1,__:[30]}),r(t,{type:"primary",onClick:ue},{default:s((()=>l[31]||(l[31]=[c("路径规划")]))),_:1,__:[31]})])])),default:s((()=>[L.value?(i(),u("div",T,[r(Ve,{column:2,border:""},{default:s((()=>[r(we,{label:"建筑名称"},{default:s((()=>[c(g(L.value.name),1)])),_:1}),r(we,{label:"建筑类型"},{default:s((()=>[r(me,{type:Q(L.value.type)},{default:s((()=>[c(g(H(L.value.type)),1)])),_:1},8,["type"])])),_:1}),r(we,{label:"地址"},{default:s((()=>[c(g(L.value.address),1)])),_:1}),r(we,{label:"楼层数"},{default:s((()=>[c(g(L.value.floors)+"层",1)])),_:1}),r(we,{label:"建筑面积"},{default:s((()=>[c(g(L.value.area)+" m²",1)])),_:1}),r(we,{label:"建筑状态"},{default:s((()=>[r(me,{type:Y(L.value.status)},{default:s((()=>[c(g(X(L.value.status)),1)])),_:1},8,["type"])])),_:1}),r(we,{label:"建成日期"},{default:s((()=>[c(g(L.value.buildDate),1)])),_:1}),r(we,{label:"创建时间"},{default:s((()=>[c(g(L.value.createTime),1)])),_:1}),r(we,{label:"描述",span:2},{default:s((()=>[c(g(L.value.description||"暂无描述"),1)])),_:1})])),_:1})])):v("",!0)])),_:1},8,["modelValue"]),r(he,{modelValue:Z.value,"onUpdate:modelValue":l[19]||(l[19]=e=>Z.value=e),title:"路径规划",width:"800px"},{default:s((()=>[n("div",null,[r(ye,{model:$,"label-width":"80px",inline:""},{default:s((()=>[r(ge,{label:"起点"},{default:s((()=>[r(b,{modelValue:$.start,"onUpdate:modelValue":l[17]||(l[17]=e=>$.start=e),placeholder:"请输入起点",style:{width:"200px"}},null,8,["modelValue"])])),_:1}),r(ge,{label:"终点"},{default:s((()=>[r(b,{modelValue:$.end,"onUpdate:modelValue":l[18]||(l[18]=e=>$.end=e),placeholder:"请输入终点",style:{width:"200px"}},null,8,["modelValue"])])),_:1}),r(ge,null,{default:s((()=>[r(t,{type:"primary",onClick:ne},{default:s((()=>l[32]||(l[32]=[c("规划路径")]))),_:1,__:[32]})])),_:1})])),_:1},8,["model"]),l[35]||(l[35]=n("div",{id:"baiduMapContainer",style:{width:"100%",height:"400px","margin-top":"16px"}},null,-1)),A.value?(i(),u("div",M,[r(xe,{title:A.value,type:"success","show-icon":""},null,8,["title"])])):v("",!0),F.value.length?(i(),u("div",O,[l[34]||(l[34]=n("h4",null,"历史路径规划",-1)),r(fe,{data:F.value,size:"small",style:{width:"100%"}},{default:s((()=>[r(ce,{prop:"start",label:"起点"}),r(ce,{prop:"end",label:"终点"}),r(ce,{prop:"time",label:"时间",width:"180"}),r(ce,{label:"操作",width:"80"},{default:s((e=>[r(t,{size:"small",onClick:l=>{return a=e.row,$.start=a.start,$.end=a.end,void ne();var a}},{default:s((()=>l[33]||(l[33]=[c("回显")]))),_:2,__:[33]},1032,["onClick"])])),_:1})])),_:1},8,["data"])])):v("",!0)])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-aa77908f"]]);export{q as default};
