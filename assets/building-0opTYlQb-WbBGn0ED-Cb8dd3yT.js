import{L as v,w as B,R as we,E as Ve,r as u,a9 as Ce,b as z,$ as T,M as g,Y as e,J as a,s as L,aa as xe,a as n,v as ke,a5 as X,Q as Ue,O as ze,l as _,P as j,U as H,C as J,x as De}from"./index-q8LaeBoo.js";import{r as Se}from"./_plugin-vue_export-helper-DlAUqK2U-lGy7RumW-DNI5evPq.js";const $e={class:"building-container"},Me={class:"page-header"},Be={class:"search-section"},Te={class:"building-list"},Oe={class:"pagination-container"},Pe={class:"dialog-footer"},Ie={key:0,class:"building-detail"},Ze={class:"dialog-footer"},qe={key:0,style:{"margin-top":"16px"}},Le={key:1,style:{"margin-top":"24px"}},je={__name:"building",setup(Je){const ee=v(!1),O=v(!1),C=v(!1),D=v(!1),k=v(),r=v(null),P=v(!1),i=B({start:"",end:""}),U=v(""),I=v([]),w=B({name:"",status:"",type:""}),y=B({currentPage:1,pageSize:10,total:0}),o=B({id:null,name:"",type:"",address:"",floors:1,area:0,status:"normal",buildDate:"",description:""}),le={name:[{required:!0,message:"请输入建筑名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择建筑类型",trigger:"change"}],address:[{required:!0,message:"请输入建筑地址",trigger:"blur"}],floors:[{required:!0,message:"请输入楼层数",trigger:"blur"}],area:[{required:!0,message:"请输入建筑面积",trigger:"blur"}],status:[{required:!0,message:"请选择建筑状态",trigger:"change"}],buildDate:[{required:!0,message:"请选择建成日期",trigger:"change"}]},V=v([{id:1,name:"益客大厦A座",type:"office",address:"北京市朝阳区建国路88号",floors:25,area:15000.5,status:"normal",buildDate:"2020-06-15",description:"现代化办公大楼，配套设施完善",createTime:"2020-01-01 10:00:00"},{id:2,name:"益客住宅小区",type:"residential",address:"北京市海淀区中关村大街100号",floors:18,area:25e3,status:"normal",buildDate:"2019-12-01",description:"高品质住宅小区，环境优美",createTime:"2019-06-01 10:00:00"},{id:3,name:"益客商业中心",type:"commercial",address:"北京市西城区西单大街200号",floors:12,area:18e3,status:"maintenance",buildDate:"2018-08-20",description:"综合性商业中心，交通便利",createTime:"2018-03-01 10:00:00"}]),ae=we(()=>o.id?"编辑建筑":"添加建筑"),N=d=>({office:"办公楼",residential:"住宅楼",commercial:"商业楼",industrial:"工业建筑"})[d]||"未知",R=d=>({office:"primary",residential:"success",commercial:"warning",industrial:"info"})[d]||"",A=d=>({normal:"正常",maintenance:"维护中",disabled:"停用"})[d]||"未知",E=d=>({normal:"success",maintenance:"warning",disabled:"danger"})[d]||"",te=()=>{o.id=null,C.value=!0},de=d=>{Object.assign(o,d),C.value=!0},oe=d=>{r.value=d,D.value=!0},ne=async d=>{try{await H.confirm(`确定要删除建筑"${d.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=V.value.findIndex(c=>c.id===d.id);l>-1&&(V.value.splice(l,1),J.success("删除成功"))}catch{}},ie=async()=>{if(k.value)try{if(await k.value.validate(),O.value=!0,await new Promise(d=>setTimeout(d,1e3)),o.id){const d=V.value.findIndex(l=>l.id===o.id);d>-1&&(V.value[d]={...o}),J.success("编辑成功")}else{const d={...o,id:Date.now(),createTime:new Date().toLocaleString()};V.value.unshift(d),J.success("添加成功")}C.value=!1,F()}catch(d){console.error("表单验证失败:",d)}finally{O.value=!1}},F=()=>{k.value&&k.value.resetFields(),Object.assign(o,{id:null,name:"",type:"",address:"",floors:1,area:0,status:"normal",buildDate:"",description:""})},x=()=>{y.currentPage=1,console.log("搜索条件:",w)},ue=()=>{Object.assign(w,{name:"",status:"",type:""}),x()},re=d=>{y.pageSize=d},se=d=>{y.currentPage=d};function pe(){var d;i.start="",i.end=((d=r.value)==null?void 0:d.address)||"",U.value="",P.value=!0,De(()=>{me()}),Y()}function W(){if(!i.start||!i.end){U.value="请填写起点和终点";return}const d=new window.BMap.Map("baiduMapContainer");d.centerAndZoom(i.end,14),d.enableScrollWheelZoom(!0),new window.BMap.DrivingRoute(d,{renderOptions:{map:d,autoViewport:!0}}).search(i.start,i.end),U.value=`已为您规划从【${i.start}】到【${i.end}】的路径`,fe({start:i.start,end:i.end,time:new Date().toLocaleString()}),Y()}function ce(d){i.start=d.start,i.end=d.end,W()}function me(){const d=new window.BMap.Map("baiduMapContainer");d.centerAndZoom(i.end||"北京",12),d.enableScrollWheelZoom(!0),d.clearOverlays(),d.addEventListener("click",function(l){const c=l.point;new window.BMap.Geocoder().getLocation(c,function(s){const b=s.address;H({title:"地图点选",message:`将【${b}】设为起点还是终点？`,showCancelButton:!0,confirmButtonText:"起点",cancelButtonText:"终点"}).then(()=>{i.start=b}).catch(()=>{i.end=b})})})}function fe(d){const l="building_route_history";let c=JSON.parse(localStorage.getItem(l)||"[]");c.unshift(d),c.length>10&&(c=c.slice(0,10)),localStorage.setItem(l,JSON.stringify(c))}function Y(){const d="building_route_history";I.value=JSON.parse(localStorage.getItem(d)||"[]")}return Ve(()=>{y.total=V.value.length}),(d,l)=>{const c=u("el-icon"),s=u("el-button"),b=u("el-input"),S=u("el-col"),p=u("el-option"),$=u("el-select"),ge=u("el-row"),m=u("el-table-column"),M=u("el-tag"),G=u("el-table"),_e=u("el-pagination"),f=u("el-form-item"),K=u("el-input-number"),be=u("el-date-picker"),Q=u("el-form"),Z=u("el-dialog"),h=u("el-descriptions-item"),ve=u("el-descriptions"),ye=u("el-alert"),he=Ce("loading");return z(),T("div",$e,[g("div",Me,[l[21]||(l[21]=g("h2",null,"建筑管理系统",-1)),e(s,{type:"primary",onClick:te},{default:a(()=>[e(c,null,{default:a(()=>[e(L(xe))]),_:1}),l[20]||(l[20]=n(" 添加建筑 "))]),_:1,__:[20]})]),g("div",Be,[e(ge,{gutter:20},{default:a(()=>[e(S,{span:6},{default:a(()=>[e(b,{modelValue:w.name,"onUpdate:modelValue":l[0]||(l[0]=t=>w.name=t),placeholder:"建筑名称",clearable:"",onClear:x,onKeyup:ke(x,["enter"])},{prefix:a(()=>[e(c,null,{default:a(()=>[e(L(X))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(S,{span:6},{default:a(()=>[e($,{modelValue:w.status,"onUpdate:modelValue":l[1]||(l[1]=t=>w.status=t),placeholder:"建筑状态",clearable:"",onChange:x},{default:a(()=>[e(p,{label:"正常",value:"normal"}),e(p,{label:"维护中",value:"maintenance"}),e(p,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(S,{span:6},{default:a(()=>[e($,{modelValue:w.type,"onUpdate:modelValue":l[2]||(l[2]=t=>w.type=t),placeholder:"建筑类型",clearable:"",onChange:x},{default:a(()=>[e(p,{label:"办公楼",value:"office"}),e(p,{label:"住宅楼",value:"residential"}),e(p,{label:"商业楼",value:"commercial"}),e(p,{label:"工业建筑",value:"industrial"})]),_:1},8,["modelValue"])]),_:1}),e(S,{span:6},{default:a(()=>[e(s,{type:"primary",onClick:x},{default:a(()=>[e(c,null,{default:a(()=>[e(L(X))]),_:1}),l[22]||(l[22]=n(" 搜索 "))]),_:1,__:[22]}),e(s,{onClick:ue},{default:a(()=>l[23]||(l[23]=[n("重置")])),_:1,__:[23]})]),_:1})]),_:1})]),g("div",Te,[Ue((z(),ze(G,{data:V.value,stripe:""},{default:a(()=>[e(m,{prop:"id",label:"ID",width:"80"}),e(m,{prop:"name",label:"建筑名称"}),e(m,{prop:"type",label:"建筑类型"},{default:a(t=>[e(M,{type:R(t.row.type)},{default:a(()=>[n(_(N(t.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"address",label:"地址"}),e(m,{prop:"floors",label:"楼层数",width:"100"}),e(m,{prop:"area",label:"建筑面积(m²)",width:"120"}),e(m,{prop:"status",label:"状态",width:"100"},{default:a(t=>[e(M,{type:E(t.row.status)},{default:a(()=>[n(_(A(t.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"buildDate",label:"建成日期",width:"120"}),e(m,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[e(s,{size:"small",onClick:q=>oe(t.row)},{default:a(()=>l[24]||(l[24]=[n("查看")])),_:2,__:[24]},1032,["onClick"]),e(s,{size:"small",type:"primary",onClick:q=>de(t.row)},{default:a(()=>l[25]||(l[25]=[n("编辑")])),_:2,__:[25]},1032,["onClick"]),e(s,{size:"small",type:"danger",onClick:q=>ne(t.row)},{default:a(()=>l[26]||(l[26]=[n("删除")])),_:2,__:[26]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[he,ee.value]]),g("div",Oe,[e(_e,{"current-page":y.currentPage,"onUpdate:currentPage":l[3]||(l[3]=t=>y.currentPage=t),"page-size":y.pageSize,"onUpdate:pageSize":l[4]||(l[4]=t=>y.pageSize=t),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),e(Z,{modelValue:C.value,"onUpdate:modelValue":l[14]||(l[14]=t=>C.value=t),title:ae.value,width:"600px",onClose:F},{footer:a(()=>[g("div",Pe,[e(s,{onClick:l[13]||(l[13]=t=>C.value=!1)},{default:a(()=>l[28]||(l[28]=[n("取消")])),_:1,__:[28]}),e(s,{type:"primary",onClick:ie,loading:O.value},{default:a(()=>l[29]||(l[29]=[n("确定")])),_:1,__:[29]},8,["loading"])])]),default:a(()=>[e(Q,{model:o,rules:le,ref_key:"buildingFormRef",ref:k,"label-width":"100px"},{default:a(()=>[e(f,{label:"建筑名称",prop:"name"},{default:a(()=>[e(b,{modelValue:o.name,"onUpdate:modelValue":l[5]||(l[5]=t=>o.name=t),placeholder:"请输入建筑名称"},null,8,["modelValue"])]),_:1}),e(f,{label:"建筑类型",prop:"type"},{default:a(()=>[e($,{modelValue:o.type,"onUpdate:modelValue":l[6]||(l[6]=t=>o.type=t),placeholder:"请选择建筑类型",style:{width:"100%"}},{default:a(()=>[e(p,{label:"办公楼",value:"office"}),e(p,{label:"住宅楼",value:"residential"}),e(p,{label:"商业楼",value:"commercial"}),e(p,{label:"工业建筑",value:"industrial"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"地址",prop:"address"},{default:a(()=>[e(b,{modelValue:o.address,"onUpdate:modelValue":l[7]||(l[7]=t=>o.address=t),placeholder:"请输入建筑地址"},null,8,["modelValue"])]),_:1}),e(f,{label:"楼层数",prop:"floors"},{default:a(()=>[e(K,{modelValue:o.floors,"onUpdate:modelValue":l[8]||(l[8]=t=>o.floors=t),min:1,max:200,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(f,{label:"建筑面积",prop:"area"},{default:a(()=>[e(K,{modelValue:o.area,"onUpdate:modelValue":l[9]||(l[9]=t=>o.area=t),min:1,precision:2,style:{width:"100%"}},null,8,["modelValue"]),l[27]||(l[27]=g("span",{style:{"margin-left":"10px",color:"#666"}},"m²",-1))]),_:1,__:[27]}),e(f,{label:"建筑状态",prop:"status"},{default:a(()=>[e($,{modelValue:o.status,"onUpdate:modelValue":l[10]||(l[10]=t=>o.status=t),placeholder:"请选择建筑状态",style:{width:"100%"}},{default:a(()=>[e(p,{label:"正常",value:"normal"}),e(p,{label:"维护中",value:"maintenance"}),e(p,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"建成日期",prop:"buildDate"},{default:a(()=>[e(be,{modelValue:o.buildDate,"onUpdate:modelValue":l[11]||(l[11]=t=>o.buildDate=t),type:"date",placeholder:"选择建成日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(f,{label:"描述",prop:"description"},{default:a(()=>[e(b,{modelValue:o.description,"onUpdate:modelValue":l[12]||(l[12]=t=>o.description=t),type:"textarea",rows:3,placeholder:"请输入建筑描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Z,{modelValue:D.value,"onUpdate:modelValue":l[16]||(l[16]=t=>D.value=t),title:"建筑详情",width:"800px"},{footer:a(()=>[g("div",Ze,[e(s,{onClick:l[15]||(l[15]=t=>D.value=!1)},{default:a(()=>l[30]||(l[30]=[n("关闭")])),_:1,__:[30]}),e(s,{type:"primary",onClick:pe},{default:a(()=>l[31]||(l[31]=[n("路径规划")])),_:1,__:[31]})])]),default:a(()=>[r.value?(z(),T("div",Ie,[e(ve,{column:2,border:""},{default:a(()=>[e(h,{label:"建筑名称"},{default:a(()=>[n(_(r.value.name),1)]),_:1}),e(h,{label:"建筑类型"},{default:a(()=>[e(M,{type:R(r.value.type)},{default:a(()=>[n(_(N(r.value.type)),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"地址"},{default:a(()=>[n(_(r.value.address),1)]),_:1}),e(h,{label:"楼层数"},{default:a(()=>[n(_(r.value.floors)+"层",1)]),_:1}),e(h,{label:"建筑面积"},{default:a(()=>[n(_(r.value.area)+" m²",1)]),_:1}),e(h,{label:"建筑状态"},{default:a(()=>[e(M,{type:E(r.value.status)},{default:a(()=>[n(_(A(r.value.status)),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"建成日期"},{default:a(()=>[n(_(r.value.buildDate),1)]),_:1}),e(h,{label:"创建时间"},{default:a(()=>[n(_(r.value.createTime),1)]),_:1}),e(h,{label:"描述",span:2},{default:a(()=>[n(_(r.value.description||"暂无描述"),1)]),_:1})]),_:1})])):j("",!0)]),_:1},8,["modelValue"]),e(Z,{modelValue:P.value,"onUpdate:modelValue":l[19]||(l[19]=t=>P.value=t),title:"路径规划",width:"800px"},{default:a(()=>[g("div",null,[e(Q,{model:i,"label-width":"80px",inline:""},{default:a(()=>[e(f,{label:"起点"},{default:a(()=>[e(b,{modelValue:i.start,"onUpdate:modelValue":l[17]||(l[17]=t=>i.start=t),placeholder:"请输入起点",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"终点"},{default:a(()=>[e(b,{modelValue:i.end,"onUpdate:modelValue":l[18]||(l[18]=t=>i.end=t),placeholder:"请输入终点",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(f,null,{default:a(()=>[e(s,{type:"primary",onClick:W},{default:a(()=>l[32]||(l[32]=[n("规划路径")])),_:1,__:[32]})]),_:1})]),_:1},8,["model"]),l[35]||(l[35]=g("div",{id:"baiduMapContainer",style:{width:"100%",height:"400px","margin-top":"16px"}},null,-1)),U.value?(z(),T("div",qe,[e(ye,{title:U.value,type:"success","show-icon":""},null,8,["title"])])):j("",!0),I.value.length?(z(),T("div",Le,[l[34]||(l[34]=g("h4",null,"历史路径规划",-1)),e(G,{data:I.value,size:"small",style:{width:"100%"}},{default:a(()=>[e(m,{prop:"start",label:"起点"}),e(m,{prop:"end",label:"终点"}),e(m,{prop:"time",label:"时间",width:"180"}),e(m,{label:"操作",width:"80"},{default:a(t=>[e(s,{size:"small",onClick:q=>ce(t.row)},{default:a(()=>l[33]||(l[33]=[n("回显")])),_:2,__:[33]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):j("",!0)])]),_:1},8,["modelValue"])])}}},Ae=Se(je,[["__scopeId","data-v-aa77908f"]]);export{Ae as default};
